{% extends "john/base.html" %}

{% block title %}Mark {{ bill.name }} as Paid â€“ John{% endblock %}

{% block page_header %}
  <h1>Mark as Paid</h1>
  <p>Confirm payment details and upload a receipt for <strong>{{ bill.name }}</strong>.</p>
{% endblock %}

{% block content %}
  <div class="row g-4">
    <div class="col-lg-7 col-xl-6">
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h2 class="h5 mb-3">Bill Summary</h2>
          <dl class="row mb-0">
            <dt class="col-sm-4">Bill</dt>
            <dd class="col-sm-8">{{ bill.name }}</dd>

            <dt class="col-sm-4">Amount</dt>
            <dd class="col-sm-8">${{ bill.amount }}</dd>

            <dt class="col-sm-4">Due Date</dt>
            <dd class="col-sm-8">{{ bill.due_date }}</dd>

            <dt class="col-sm-4">Account</dt>
            <dd class="col-sm-8">{{ bill.account }}</dd>

            <dt class="col-sm-4">Type</dt>
            <dd class="col-sm-8">
              {% if bill.is_auto_pay %}
                <span class="badge bg-success-subtle text-success border border-success-subtle">
                  Auto-pay
                </span>
              {% else %}
                <span class="badge bg-warning-subtle text-warning border border-warning-subtle">
                  Manual
                </span>
              {% endif %}
            </dd>
          </dl>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h5 mb-3">Payment Details</h2>
          <form method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}

            {% for field in form %}
              <div class="mb-3">
                <label class="form-label" for="{{ field.id_for_label }}">
                  {{ field.label }}
                  {% if field.field.required %}
                    <span class="text-danger">*</span>
                  {% endif %}
                </label>
                {{ field }}
                {% if field.help_text %}
                  <div class="form-text">{{ field.help_text }}</div>
                {% endif %}
                {% for error in field.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>
            {% endfor %}

            <div class="d-flex justify-content-between mt-3">
              <a href="{% url 'john:bill_list' %}" class="btn btn-outline-secondary">
                Back to Unpaid Bills
              </a>
              <button type="submit" class="btn btn-success">
                Confirm Paid
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    {% if bill.receipt_image %}
      <div class="col-lg-5 col-xl-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h2 class="h6 mb-3">Existing Receipt</h2>
            <img src="{{ bill.receipt_image.url }}"
                 alt="Receipt for {{ bill.name }}"
                 class="img-fluid rounded border">
          </div>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}
